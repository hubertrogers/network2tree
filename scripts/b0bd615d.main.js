"use strict";var treeNetwork=angular.module("treeNetwork",[]);treeNetwork.controller("NodeListCtrl",["$scope","$http",function(a,b){b.get("data/movie-network-25-7-3.json").success(function(b){a.query="dar",a.nodes=b.nodes}),a.orderProp="name",a.selectedNode={label:"The Dark Knight (2008)",director:"Christopher Nolan"},a.setNode=function(b){a.selectedNode=b},a.isSelected=function(b){return a.selectedNode.label===b.label}}]),function(){angular.module("treeNetwork").directive("network",function(){return{restrict:"E",scope:{selectedNode:"="},template:'<div class="col-md-8"></div>',replace:!1,link:function(a,b){a.$watch("selectedNode",function(){function c(a,b){var e=d3.event&&d3.event.altKey?5e3:500,f=o.nodes(j).reverse();f.forEach(function(a){a.y=180*a.depth});var g=u.selectAll("g.node").data(f,function(a){return a.id||(a.id=++n)}),h=g.enter().append("svg:g").attr("class","node").attr("transform",function(){return"translate("+b.y0+","+b.x0+")"}).on("click",function(b){d(a,b),c(a,b)});h.append("svg:circle").attr("r",1e-6).style("fill",function(a){return a._children||!a.children&&!a._children?q(a.director):"#fff"}).style("stroke",function(a){return q(a.director)}),h.append("svg:text").attr("x",function(a){return a.children||a._children?-10:10}).attr("dy",".35em").attr("text-anchor",function(a){return a.children||a._children?"end":"start"}).text(function(a){return a.label}).style("fill-opacity",1e-6);var i=g.transition().duration(e).attr("transform",function(a){return"translate("+a.y+","+a.x+")"});i.select("circle").attr("r",4.5).style("fill",function(a){return a._children||!a.children&&!a._children?(a.children||a._children,q(a.director)):"#fff"}).style("stroke",function(a){return q(a.director)}),i.select("text").style("fill-opacity",1);var k=g.exit().transition().duration(e).attr("transform",function(){return"translate("+b.y+","+b.x+")"}).remove();k.select("circle").attr("r",1e-6),k.select("text").style("fill-opacity",1e-6);var l=u.selectAll("path.link").data(o.links(f),function(a){return a.target.id});l.enter().insert("svg:path","g").attr("class","link").attr("d",function(){var a={x:b.x0,y:b.y0};return p({source:a,target:a})}).transition().duration(e).attr("d",p),l.transition().duration(e).attr("d",p),l.exit().transition().duration(e).attr("d",function(){var a={x:b.x,y:b.y};return p({source:a,target:a})}).remove(),f.forEach(function(a){a.x0=a.x,a.y0=a.y})}function d(a,b){b.children?(b._children=f(a,b.label,b.children),b.children=null,v.splice(v.indexOf(b.label))):(1==v.length||-1==v.indexOf(b.label))&&(b.children=f(a,b.label,b._children),b._children=null)}function e(a,b){var c={label:b};for(var d in a)a[d].label==b&&(c.children=a[d].children,c.director=a[d].director,v.push(b));return console.log(c),c}function f(a,b){var c=e(a,b);return c.children}function g(a){for(var b={},c=0;c<a.nodes.length;c++)b[a.nodes[c].label]=a.nodes[c];for(var d in b){for(var e=[],c=0;c<a.links.length;c++)if(a.nodes[a.links[c].source].label==d){var f={label:a.nodes[a.links[c].target].label,weight:a.links[c].weight,director:a.nodes[a.links[c].source].director};e.push(f)}b[d].children=e}return b}function h(){u.attr("transform","translate("+d3.event.translate+")scale("+d3.event.scale+")")}function i(a){var b=s.scale(),c=-a.y0,d=-a.x0;c=c*b+l/3,d=d*b+m/2,d3.select("g").transition().duration(r).attr("transform","translate("+c+","+d+")scale("+b+")"),s.scale(b),s.translate([c,d])}b.empty();var j,k=[20,120,20,120],l=800-k[1]-k[3],m=600-k[0]-k[2],n=0,o=d3.layout.tree().size([m,l]),p=d3.svg.diagonal().projection(function(a){return[a.y,a.x]}),q=d3.scale.category10().domain(d3.range(10)),n=0,r=750,s=d3.behavior.zoom().scaleExtent([.1,3]).on("zoom",h),t=(s.scale(),d3.select(b[0]).append("svg:svg").attr("width",l+k[1]+k[3]).attr("height",m+k[0]+k[2]).attr("class","overlay").call(s)),u=t.append("g"),v=[];d3.json("data/movie-network-25-7-3.json",function(b){function f(a){a.children&&(a.children.forEach(f),d(k,a))}var h=a.selectedNode.label;v.push(h);var k=g(b),l=e(k,h);j=l,j.x0=m/2,j.y0=0,"The Dark Knight (2008)"==h&&(j.children.forEach(f),d(k,j.children[4]),d(k,j.children[4].children[5])),c(k,j),i(j)})})}}})}();